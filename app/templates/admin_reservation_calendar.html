{% extends "base.html" %}

{% block title %}予約カレンダー - {{ store.name }}{% endblock %}

{% block content %}
<div class="container">
  <h1>予約カレンダー</h1>
  
  <div class="store-info-card">
    <h2>{{ store.name }}</h2>
    <p><strong>店舗ID:</strong> {{ store.id }}</p>
  </div>
  
  <!-- 月選択 -->
  <div class="month-selector">
    <a href="?year={{ year if month > 1 else year - 1 }}&month={{ month - 1 if month > 1 else 12 }}" class="btn btn-secondary">前月</a>
    <h2>{{ year }}年 {{ month }}月</h2>
    <a href="?year={{ year if month < 12 else year + 1 }}&month={{ month + 1 if month < 12 else 1 }}" class="btn btn-secondary">次月</a>
  </div>
  
  <div class="action-buttons">
    <a href="{{ url_for('reservation_admin.reservation_list', store_id=store.id) }}" class="btn btn-info">予約一覧</a>
    <a href="{{ url_for('reservation_admin.settings', store_id=store.id) }}" class="btn btn-info">予約設定</a>
  </div>
  
  <!-- カレンダー -->
  <div class="calendar">
    <div class="calendar-header">
      <div class="calendar-day-header">日</div>
      <div class="calendar-day-header">月</div>
      <div class="calendar-day-header">火</div>
      <div class="calendar-day-header">水</div>
      <div class="calendar-day-header">木</div>
      <div class="calendar-day-header">金</div>
      <div class="calendar-day-header">土</div>
    </div>
    
    <div class="calendar-body">
      {% for week in calendar_weeks %}
        {% for day in week %}
          {% if day == 0 %}
            <div class="calendar-day empty"></div>
          {% else %}
            {% set date_str = '%04d-%02d-%02d' | format(year, month, day) %}
            {% set reservation_data = reservations_by_date.get(date_str) %}
            
            <div class="calendar-day {% if reservation_data %}has-reservation{% endif %}">
              <div class="day-number">{{ day }}</div>
              {% if reservation_data %}
                <div class="reservation-info">
                  <div class="reservation-count">{{ reservation_data.count }}件</div>
                  <div class="reservation-guests">{{ reservation_data.guests }}名</div>
                </div>
                <a href="{{ url_for('reservation_admin.reservation_list', store_id=store.id, date=date_str) }}" class="view-link">詳細</a>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
  
  <div class="back-link">
    <a href="{{ url_for('admin.store_apps', store_id=store.id) }}">店舗アプリ一覧に戻る</a>
  </div>
</div>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .store-info-card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .store-info-card h2 {
    margin: 0 0 10px 0;
    color: #333;
  }
  
  .month-selector {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 16px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
  }
  
  .month-selector h2 {
    margin: 0;
    font-size: 24px;
    color: #333;
  }
  
  .action-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  
  .calendar {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .calendar-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: #f8f9fa;
    border-bottom: 2px solid #e0e0e0;
  }
  
  .calendar-day-header {
    padding: 12px;
    text-align: center;
    font-weight: 600;
    color: #333;
  }
  
  .calendar-body {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: #e0e0e0;
  }
  
  .calendar-day {
    background: white;
    min-height: 100px;
    padding: 8px;
    position: relative;
  }
  
  .calendar-day.empty {
    background: #f8f9fa;
  }
  
  .calendar-day.has-reservation {
    background: #e3f2fd;
  }
  
  .day-number {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
  }
  
  .reservation-info {
    font-size: 12px;
    color: #666;
    margin-top: 8px;
  }
  
  .reservation-count {
    font-weight: 600;
    color: #2196F3;
  }
  
  .reservation-guests {
    color: #666;
  }
  
  .view-link {
    display: inline-block;
    margin-top: 8px;
    font-size: 11px;
    color: #2196F3;
    text-decoration: none;
    font-weight: 500;
  }
  
  .view-link:hover {
    text-decoration: underline;
  }
  
  .btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s;
  }
  
  .btn-secondary {
    background: #2196F3;
    color: white;
  }
  
  .btn-secondary:hover {
    background: #0b7dda;
  }
  
  .btn-info {
    background: #FF9800;
    color: white;
  }
  
  .btn-info:hover {
    background: #F57C00;
  }
  
  .back-link {
    margin-top: 30px;
    text-align: center;
  }
  
  .back-link a {
    color: #2196F3;
    text-decoration: none;
    font-weight: 500;
  }
  
  .back-link a:hover {
    text-decoration: underline;
  }
</style>
{% endblock %}
